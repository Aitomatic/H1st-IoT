parameters:
  PROJECT:
    type: string
    required: true

  EQUIPMENT_GENERAL_TYPE:
    type: string
    required: true

  EQUIPMENT_UNIQUE_TYPE_GROUP:
    type: string
    required: true

  FROM_DATE:
    type: string
    required: false

  TO_DATE:
    type: string
    required: false

  WORKER_ROLE:
    type: string
    default: etl   # run on BAI CPU worker

  SLACK_CHANNEL:
    type: string
    default: '#devops-alerts'

tasks:
  - name: adhoc-ppp-anom-alert
    type: python
    worker_role: ${WORKER_ROLE}
    script: adhoc/ppp-anom-alert.py

on_failure:
  - type: parallel
    tasks:
      - name: slack-notification
        type: slack
        worker_role: ${WORKER_ROLE}
        channel: ${SLACK_CHANNEL}
        text: 'Arimo.IoT.PredMaint BAI-pkg: adhoc-ppp-anom-alert has failed :cry:'

on_success:
  - type: parallel
    tasks:
      - name: slack-notification
        type: slack
        worker_role: ${WORKER_ROLE}
        channel: ${SLACK_CHANNEL}
        text: 'Arimo.IoT.PredMaint BAI-pkg: adhoc-ppp-anom-alert has succeeded :smile:'
